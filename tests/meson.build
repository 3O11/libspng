png_dep = dependency('libpng', version : '>=1.6.0')

bench = executable('bench', 'benchmark.c',
                   link_with: lib,
                   include_directories : include,
                   dependencies : [ zlib_dep, png_dep ],
                   override_options : [ 'c_std=c11' ])

benchmark('benchmark', bench, args: ['../benchmark_images/large_rgb8.png'])
benchmark('benchmark', bench, args: ['../benchmark_images/large_rgba8.png'])
benchmark('benchmark', bench, args: ['../benchmark_images/medium_rgb8.png'])
benchmark('benchmark', bench, args: ['../benchmark_images/medium_rgba8.png'])
benchmark('benchmark', bench, args: ['../benchmark_images/small_rgb8.png'])
benchmark('benchmark', bench, args: ['../benchmark_images/small_rgba8.png'])

test_exe = executable('testsuite',
                      'testsuite.c',
                      link_with : lib,
                      include_directories : include,
                      dependencies : png_dep)

imgdir = join_paths(meson.current_source_dir(), 'images')
crashdir = join_paths(meson.current_source_dir(), 'crashers')

test('basi0g01', test_exe, workdir : imgdir, args: ['basi0g01.png'])
test('basi0g02', test_exe, workdir : imgdir, args: ['basi0g02.png'])
test('basi0g04', test_exe, workdir : imgdir, args: ['basi0g04.png'])
test('basi0g08', test_exe, workdir : imgdir, args: ['basi0g08.png'])
test('basi0g16', test_exe, workdir : imgdir, args: ['basi0g16.png'])
test('basi2c08', test_exe, workdir : imgdir, args: ['basi2c08.png'])
test('basi2c16', test_exe, workdir : imgdir, args: ['basi2c16.png'])
test('basi3p01', test_exe, workdir : imgdir, args: ['basi3p01.png'])
test('basi3p02', test_exe, workdir : imgdir, args: ['basi3p02.png'])
test('basi3p04', test_exe, workdir : imgdir, args: ['basi3p04.png'])
test('basi3p08', test_exe, workdir : imgdir, args: ['basi3p08.png'])
test('basi4a08', test_exe, workdir : imgdir, args: ['basi4a08.png'])
test('basi4a16', test_exe, workdir : imgdir, args: ['basi4a16.png'])
test('basi6a08', test_exe, workdir : imgdir, args: ['basi6a08.png'])
test('basi6a16', test_exe, workdir : imgdir, args: ['basi6a16.png'])
test('basn0g01', test_exe, workdir : imgdir, args: ['basn0g01.png'])
test('basn0g02', test_exe, workdir : imgdir, args: ['basn0g02.png'])
test('basn0g04', test_exe, workdir : imgdir, args: ['basn0g04.png'])
test('basn0g08', test_exe, workdir : imgdir, args: ['basn0g08.png'])
test('basn0g16', test_exe, workdir : imgdir, args: ['basn0g16.png'])
test('basn2c08', test_exe, workdir : imgdir, args: ['basn2c08.png'])
test('basn2c16', test_exe, workdir : imgdir, args: ['basn2c16.png'])
test('basn3p01', test_exe, workdir : imgdir, args: ['basn3p01.png'])
test('basn3p02', test_exe, workdir : imgdir, args: ['basn3p02.png'])
test('basn3p04', test_exe, workdir : imgdir, args: ['basn3p04.png'])
test('basn3p08', test_exe, workdir : imgdir, args: ['basn3p08.png'])
test('basn4a08', test_exe, workdir : imgdir, args: ['basn4a08.png'])
test('basn4a16', test_exe, workdir : imgdir, args: ['basn4a16.png'])
test('basn6a08', test_exe, workdir : imgdir, args: ['basn6a08.png'])
test('basn6a16', test_exe, workdir : imgdir, args: ['basn6a16.png'])
test('bgai4a08', test_exe, workdir : imgdir, args: ['bgai4a08.png'])
test('bgai4a16', test_exe, workdir : imgdir, args: ['bgai4a16.png'])
test('bgan6a08', test_exe, workdir : imgdir, args: ['bgan6a08.png'])
test('bgan6a16', test_exe, workdir : imgdir, args: ['bgan6a16.png'])
test('bgbn4a08', test_exe, workdir : imgdir, args: ['bgbn4a08.png'])
test('bggn4a16', test_exe, workdir : imgdir, args: ['bggn4a16.png'])
test('bgwn6a08', test_exe, workdir : imgdir, args: ['bgwn6a08.png'])
test('bgyn6a16', test_exe, workdir : imgdir, args: ['bgyn6a16.png'])
test('ccwn2c08', test_exe, workdir : imgdir, args: ['ccwn2c08.png'])
test('ccwn3p08', test_exe, workdir : imgdir, args: ['ccwn3p08.png'])
test('cdfn2c08', test_exe, workdir : imgdir, args: ['cdfn2c08.png'])
test('cdhn2c08', test_exe, workdir : imgdir, args: ['cdhn2c08.png'])
test('cdsn2c08', test_exe, workdir : imgdir, args: ['cdsn2c08.png'])
test('cdun2c08', test_exe, workdir : imgdir, args: ['cdun2c08.png'])
test('ch1n3p04', test_exe, workdir : imgdir, args: ['ch1n3p04.png'])
test('ch2n3p08', test_exe, workdir : imgdir, args: ['ch2n3p08.png'])
test('cm0n0g04', test_exe, workdir : imgdir, args: ['cm0n0g04.png'])
test('cm7n0g04', test_exe, workdir : imgdir, args: ['cm7n0g04.png'])
test('cm9n0g04', test_exe, workdir : imgdir, args: ['cm9n0g04.png'])
test('cs3n2c16', test_exe, workdir : imgdir, args: ['cs3n2c16.png'])
test('cs3n3p08', test_exe, workdir : imgdir, args: ['cs3n3p08.png'])
test('cs5n2c08', test_exe, workdir : imgdir, args: ['cs5n2c08.png'])
test('cs5n3p08', test_exe, workdir : imgdir, args: ['cs5n3p08.png'])
test('cs8n2c08', test_exe, workdir : imgdir, args: ['cs8n2c08.png'])
test('cs8n3p08', test_exe, workdir : imgdir, args: ['cs8n3p08.png'])
test('ct0n0g04', test_exe, workdir : imgdir, args: ['ct0n0g04.png'])
test('ct1n0g04', test_exe, workdir : imgdir, args: ['ct1n0g04.png'])
test('cten0g04', test_exe, workdir : imgdir, args: ['cten0g04.png'])
test('ctfn0g04', test_exe, workdir : imgdir, args: ['ctfn0g04.png'])
test('ctgn0g04', test_exe, workdir : imgdir, args: ['ctgn0g04.png'])
test('cthn0g04', test_exe, workdir : imgdir, args: ['cthn0g04.png'])
test('ctjn0g04', test_exe, workdir : imgdir, args: ['ctjn0g04.png'])
test('ctzn0g04', test_exe, workdir : imgdir, args: ['ctzn0g04.png'])
test('exif2c08', test_exe, workdir : imgdir, args: ['exif2c08.png'])
test('f00n0g08', test_exe, workdir : imgdir, args: ['f00n0g08.png'])
test('f00n2c08', test_exe, workdir : imgdir, args: ['f00n2c08.png'])
test('f01n0g08', test_exe, workdir : imgdir, args: ['f01n0g08.png'])
test('f01n2c08', test_exe, workdir : imgdir, args: ['f01n2c08.png'])
test('f02n0g08', test_exe, workdir : imgdir, args: ['f02n0g08.png'])
test('f02n2c08', test_exe, workdir : imgdir, args: ['f02n2c08.png'])
test('f03n0g08', test_exe, workdir : imgdir, args: ['f03n0g08.png'])
test('f03n2c08', test_exe, workdir : imgdir, args: ['f03n2c08.png'])
test('f04n0g08', test_exe, workdir : imgdir, args: ['f04n0g08.png'])
test('f04n2c08', test_exe, workdir : imgdir, args: ['f04n2c08.png'])
test('f99n0g04', test_exe, workdir : imgdir, args: ['f99n0g04.png'])
test('g03n0g16', test_exe, workdir : imgdir, args: ['g03n0g16.png'])
test('g03n2c08', test_exe, workdir : imgdir, args: ['g03n2c08.png'])
test('g03n3p04', test_exe, workdir : imgdir, args: ['g03n3p04.png'])
test('g04n0g16', test_exe, workdir : imgdir, args: ['g04n0g16.png'])
test('g04n2c08', test_exe, workdir : imgdir, args: ['g04n2c08.png'])
test('g04n3p04', test_exe, workdir : imgdir, args: ['g04n3p04.png'])
test('g05n0g16', test_exe, workdir : imgdir, args: ['g05n0g16.png'])
test('g05n2c08', test_exe, workdir : imgdir, args: ['g05n2c08.png'])
test('g05n3p04', test_exe, workdir : imgdir, args: ['g05n3p04.png'])
test('g07n0g16', test_exe, workdir : imgdir, args: ['g07n0g16.png'])
test('g07n2c08', test_exe, workdir : imgdir, args: ['g07n2c08.png'])
test('g07n3p04', test_exe, workdir : imgdir, args: ['g07n3p04.png'])
test('g10n0g16', test_exe, workdir : imgdir, args: ['g10n0g16.png'])
test('g10n2c08', test_exe, workdir : imgdir, args: ['g10n2c08.png'])
test('g10n3p04', test_exe, workdir : imgdir, args: ['g10n3p04.png'])
test('g25n0g16', test_exe, workdir : imgdir, args: ['g25n0g16.png'])
test('g25n2c08', test_exe, workdir : imgdir, args: ['g25n2c08.png'])
test('g25n3p04', test_exe, workdir : imgdir, args: ['g25n3p04.png'])
test('oi1n0g16', test_exe, workdir : imgdir, args: ['oi1n0g16.png'])
test('oi1n2c16', test_exe, workdir : imgdir, args: ['oi1n2c16.png'])
test('oi2n0g16', test_exe, workdir : imgdir, args: ['oi2n0g16.png'])
test('oi2n2c16', test_exe, workdir : imgdir, args: ['oi2n2c16.png'])
test('oi4n0g16', test_exe, workdir : imgdir, args: ['oi4n0g16.png'])
test('oi4n2c16', test_exe, workdir : imgdir, args: ['oi4n2c16.png'])
test('oi9n0g16', test_exe, workdir : imgdir, args: ['oi9n0g16.png'])
test('oi9n2c16', test_exe, workdir : imgdir, args: ['oi9n2c16.png'])
test('pp0n2c16', test_exe, workdir : imgdir, args: ['pp0n2c16.png'])
test('pp0n6a08', test_exe, workdir : imgdir, args: ['pp0n6a08.png'])
test('ps1n0g08', test_exe, workdir : imgdir, args: ['ps1n0g08.png'])
test('ps1n2c16', test_exe, workdir : imgdir, args: ['ps1n2c16.png'])
test('ps2n0g08', test_exe, workdir : imgdir, args: ['ps2n0g08.png'])
test('ps2n2c16', test_exe, workdir : imgdir, args: ['ps2n2c16.png'])
test('s01i3p01', test_exe, workdir : imgdir, args: ['s01i3p01.png'])
test('s01n3p01', test_exe, workdir : imgdir, args: ['s01n3p01.png'])
test('s02i3p01', test_exe, workdir : imgdir, args: ['s02i3p01.png'])
test('s02n3p01', test_exe, workdir : imgdir, args: ['s02n3p01.png'])
test('s03i3p01', test_exe, workdir : imgdir, args: ['s03i3p01.png'])
test('s03n3p01', test_exe, workdir : imgdir, args: ['s03n3p01.png'])
test('s04i3p01', test_exe, workdir : imgdir, args: ['s04i3p01.png'])
test('s04n3p01', test_exe, workdir : imgdir, args: ['s04n3p01.png'])
test('s05i3p02', test_exe, workdir : imgdir, args: ['s05i3p02.png'])
test('s05n3p02', test_exe, workdir : imgdir, args: ['s05n3p02.png'])
test('s06i3p02', test_exe, workdir : imgdir, args: ['s06i3p02.png'])
test('s06n3p02', test_exe, workdir : imgdir, args: ['s06n3p02.png'])
test('s07i3p02', test_exe, workdir : imgdir, args: ['s07i3p02.png'])
test('s07n3p02', test_exe, workdir : imgdir, args: ['s07n3p02.png'])
test('s08i3p02', test_exe, workdir : imgdir, args: ['s08i3p02.png'])
test('s08n3p02', test_exe, workdir : imgdir, args: ['s08n3p02.png'])
test('s09i3p02', test_exe, workdir : imgdir, args: ['s09i3p02.png'])
test('s09n3p02', test_exe, workdir : imgdir, args: ['s09n3p02.png'])
test('s32i3p04', test_exe, workdir : imgdir, args: ['s32i3p04.png'])
test('s32n3p04', test_exe, workdir : imgdir, args: ['s32n3p04.png'])
test('s33i3p04', test_exe, workdir : imgdir, args: ['s33i3p04.png'])
test('s33n3p04', test_exe, workdir : imgdir, args: ['s33n3p04.png'])
test('s34i3p04', test_exe, workdir : imgdir, args: ['s34i3p04.png'])
test('s34n3p04', test_exe, workdir : imgdir, args: ['s34n3p04.png'])
test('s35i3p04', test_exe, workdir : imgdir, args: ['s35i3p04.png'])
test('s35n3p04', test_exe, workdir : imgdir, args: ['s35n3p04.png'])
test('s36i3p04', test_exe, workdir : imgdir, args: ['s36i3p04.png'])
test('s36n3p04', test_exe, workdir : imgdir, args: ['s36n3p04.png'])
test('s37i3p04', test_exe, workdir : imgdir, args: ['s37i3p04.png'])
test('s37n3p04', test_exe, workdir : imgdir, args: ['s37n3p04.png'])
test('s38i3p04', test_exe, workdir : imgdir, args: ['s38i3p04.png'])
test('s38n3p04', test_exe, workdir : imgdir, args: ['s38n3p04.png'])
test('s39i3p04', test_exe, workdir : imgdir, args: ['s39i3p04.png'])
test('s39n3p04', test_exe, workdir : imgdir, args: ['s39n3p04.png'])
test('s40i3p04', test_exe, workdir : imgdir, args: ['s40i3p04.png'])
test('s40n3p04', test_exe, workdir : imgdir, args: ['s40n3p04.png'])
test('tbbn0g04', test_exe, workdir : imgdir, args: ['tbbn0g04.png'])
test('tbbn2c16', test_exe, workdir : imgdir, args: ['tbbn2c16.png'])
test('tbbn3p08', test_exe, workdir : imgdir, args: ['tbbn3p08.png'])
test('tbgn2c16', test_exe, workdir : imgdir, args: ['tbgn2c16.png'])
test('tbgn3p08', test_exe, workdir : imgdir, args: ['tbgn3p08.png'])
test('tbrn2c08', test_exe, workdir : imgdir, args: ['tbrn2c08.png'])
test('tbwn0g16', test_exe, workdir : imgdir, args: ['tbwn0g16.png'])
test('tbwn3p08', test_exe, workdir : imgdir, args: ['tbwn3p08.png'])
test('tbyn3p08', test_exe, workdir : imgdir, args: ['tbyn3p08.png'])
test('tm3n3p02', test_exe, workdir : imgdir, args: ['tm3n3p02.png'])
test('tp0n0g08', test_exe, workdir : imgdir, args: ['tp0n0g08.png'])
test('tp0n2c08', test_exe, workdir : imgdir, args: ['tp0n2c08.png'])
test('tp0n3p08', test_exe, workdir : imgdir, args: ['tp0n3p08.png'])
test('tp1n3p08', test_exe, workdir : imgdir, args: ['tp1n3p08.png'])
test('xc1n0g08', test_exe, workdir : imgdir, args: ['xc1n0g08.png'], should_fail : true)
test('xc9n2c08', test_exe, workdir : imgdir, args: ['xc9n2c08.png'], should_fail : true)
test('xcrn0g04', test_exe, workdir : imgdir, args: ['xcrn0g04.png'], should_fail : true)
test('xcsn0g01', test_exe, workdir : imgdir, args: ['xcsn0g01.png'], should_fail : true)
test('xd0n2c08', test_exe, workdir : imgdir, args: ['xd0n2c08.png'], should_fail : true)
test('xd3n2c08', test_exe, workdir : imgdir, args: ['xd3n2c08.png'], should_fail : true)
test('xd9n2c08', test_exe, workdir : imgdir, args: ['xd9n2c08.png'], should_fail : true)
test('xdtn0g01', test_exe, workdir : imgdir, args: ['xdtn0g01.png'], should_fail : true)
test('xhdn0g08', test_exe, workdir : imgdir, args: ['xhdn0g08.png'], should_fail : true)
test('xlfn0g04', test_exe, workdir : imgdir, args: ['xlfn0g04.png'], should_fail : true)
test('xs1n0g01', test_exe, workdir : imgdir, args: ['xs1n0g01.png'], should_fail : true)
test('xs2n0g01', test_exe, workdir : imgdir, args: ['xs2n0g01.png'], should_fail : true)
test('xs4n0g01', test_exe, workdir : imgdir, args: ['xs4n0g01.png'], should_fail : true)
test('xs7n0g01', test_exe, workdir : imgdir, args: ['xs7n0g01.png'], should_fail : true)
test('z00n2c08', test_exe, workdir : imgdir, args: ['z00n2c08.png'])
test('z03n2c08', test_exe, workdir : imgdir, args: ['z03n2c08.png'])
test('z06n2c08', test_exe, workdir : imgdir, args: ['z06n2c08.png'])
test('z09n2c08', test_exe, workdir : imgdir, args: ['z09n2c08.png'])

test('badadler', test_exe, workdir : crashdir, args : ['badadler.png'], should_fail : true)
test('badcrc', test_exe, workdir : crashdir, args : ['badcrc.png'], should_fail : true)
test('bad_iccp', test_exe, workdir : crashdir, args : ['bad_iCCP.png'], should_fail : true)
test('empty_ancillary', test_exe, workdir : imgdir, args : ['empty_ancillary_chunks.png'], should_fail : true)
test('huge_bkgd', test_exe, workdir : crashdir, args : ['huge_bKGD_chunk.png'], should_fail : true)
test('huge_chrm', test_exe, workdir : crashdir, args : ['huge_cHRM_chunk.png'], should_fail : true)
test('huge_exif', test_exe, workdir : crashdir, args : ['huge_eXIf_chunk.png'], should_fail : true)
test('huge_gama', test_exe, workdir : crashdir, args : ['huge_gAMA_chunk.png'], should_fail : true)
test('huge_hist', test_exe, workdir : crashdir, args : ['huge_hIST_chunk.png'], should_fail : true)
test('huge_iccp', test_exe, workdir : crashdir, args : ['huge_iCCP_chunk.png'], should_fail : true)
test('huge_idat', test_exe, workdir : crashdir, args : ['huge_IDAT_chunk.png'], should_fail : true)
test('huge_itxt', test_exe, workdir : crashdir, args : ['huge_iTXt_chunk.png'], should_fail : true)
test('huge_junk_safe_to_copy', test_exe, workdir : crashdir, args : ['huge_juNk_safe_to_copy.png'], should_fail : true)
test('huge_junk_unsafe_to_copy', test_exe, workdir : crashdir ,args : ['huge_juNK_unsafe_to_copy.png'], should_fail : true)
test('huge_pcal', test_exe, workdir : crashdir, args : ['huge_pCAL_chunk.png'], should_fail : true)
test('huge_phys', test_exe, workdir : crashdir, args : ['huge_pHYs_chunk.png'], should_fail : true)
test('huge_scal', test_exe, workdir : crashdir, args : ['huge_sCAL_chunk.png'], should_fail : true)
test('huge_splt', test_exe, workdir : crashdir, args : ['huge_sPLT_chunk.png'], should_fail : true)
test('huge_srgb', test_exe, workdir : crashdir, args : ['huge_sRGB_chunk.png'], should_fail : true)
test('huge_ster', test_exe, workdir : crashdir, args : ['huge_sTER_chunk.png'], should_fail : true)
test('huge_text', test_exe, workdir : crashdir, args : ['huge_tEXt_chunk.png'], should_fail : true)
test('huge_time', test_exe, workdir : crashdir, args : ['huge_tIME_chunk.png'], should_fail : true)
test('huge_ztxt', test_exe, workdir : crashdir, args : ['huge_zTXt_chunk.png'], should_fail : true)
